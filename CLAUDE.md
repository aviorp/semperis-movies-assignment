# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Commands

- **Dev server:** `pnpm dev`
- **Build:** `pnpm build` (runs type-check + vite build in parallel)
- **Type-check only:** `pnpm type-check` (runs `vue-tsc --build`)
- **Lint:** `pnpm lint` (runs oxlint then eslint sequentially, both with `--fix`)
- **Format:** `pnpm format` (prettier on `src/`)
- **Run all tests once:** `pnpm test` (runs `vitest run`)
- **Run tests in watch mode:** `pnpm test:unit` (runs `vitest`)
- **Run a single test:** `pnpm test:unit src/stores/filtersStore.spec.ts`
- **Package manager:** pnpm (required)

## Architecture

Vue 3 + TypeScript SPA using Vite, with **@nuxt/ui v4** as the component library (used as a Vue plugin, not inside Nuxt). Styling is Tailwind CSS v4 via `@nuxt/ui`.

### Key layers

- **Entry:** `src/main.ts` — creates the Vue app, installs Pinia, Vue Router, and `@nuxt/ui/vue-plugin`
- **Root component:** `src/App.vue` — wraps everything in `<UApp>` (required by @nuxt/ui)
- **Routing:** `src/router/routes.ts` defines route records with lazy-loaded components. Routes are nested under layout components.
- **Layouts:** `src/layouts/` — layout shells using `UDashboardGroup`/`UDashboardPanel`/`UDashboardNavbar` components. The `default-layout.vue` reads `route.meta.title` for the navbar title.
- **Pages:** `src/pages/` — page-level components rendered inside layouts via `<RouterView>`
- **State:** Pinia stores in `src/stores/` using the Composition API (setup function) style
- **Tests:** Vitest + jsdom + `@vue/test-utils`, test files are co-located next to their source (e.g. `src/stores/filtersStore.spec.ts`)

### Path aliases

- `@/` maps to `src/` (configured in both vite.config.ts and tsconfig.app.json)
- `#build/ui/*` maps to `node_modules/.nuxt-ui/ui/*` (auto-generated by @nuxt/ui)

## Rules

- **Never read `node_modules/`** — do not browse or inspect files inside `node_modules/`. If you need to understand a dependency's API, use the available skills, CLAUDE.md instructions, or web search instead.

## Code style

- **Early returns over if/else** — use guard clauses (early returns) instead of if/else blocks. Flatten nested logic by returning early for invalid/edge cases.
- **No semicolons**, single quotes, 100 char print width (Prettier config)
- **No non-null assertions (`!`)** — never use TypeScript's `!` operator. Handle `undefined`/`null` explicitly with proper checks or fallbacks.
- **No type assertions (`as`)** — never use `as Type` casts. Use type guards, type annotations, or `@ts-expect-error` (in tests only) instead. `as const` and `as const satisfies` are allowed.
- **Extract template conditions into computed properties** — never use compound boolean expressions (e.g. `v-if="loading && !hasResults"`) directly in templates. Extract them into named computed properties with descriptive names (e.g. `showSkeleton`, `showEmpty`, `hasCast`).
- **No empty `()` in template event handlers** — when a handler takes no arguments, omit the parentheses: `@click="clearAll"` not `@click="clearAll()"`. Only use `()` when passing arguments.
- **Destructure everything** — destructure API responses (`const { results, total_pages } = ...`), props (`const { movie } = defineProps()`), v-for items (`v-for="{ id, name } in items"`), and store refs (`storeToRefs`). Avoid `x.y` chaining.
- **Coupled components live next to their page** — components used by a single page go in a subfolder next to that page (e.g. `src/pages/movie-detail/media-hero.vue`). Shared/global components stay in `src/components/`.
- ESLint uses `vue/flat/essential` + `@vue/eslint-config-typescript` recommended
- Oxlint runs first (correctness category, plugins: eslint, typescript, unicorn, oxc, vue)
- Prettier runs via `eslint-config-prettier` to disable conflicting ESLint rules
